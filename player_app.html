<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Potato Music App</title>
  <style>
    body { font-family: sans-serif; background: #fff; }
    #player { width: 1px; height: 1px; overflow: hidden; }
  </style>
</head>
<body>
  <div id="player"></div>

  <script>
    const API_BASE = "https://potato-music.onrender.com";
    const WS_URL = "wss://potato-music.onrender.com";

    let player;
    let ws;

    function connectWebSocket() {
      ws = new WebSocket(WS_URL);

      ws.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        if (msg.type === "play" && player) {
          const elapsed = Math.floor(Date.now() / 1000) - msg.startTime;
          player.loadVideoById(msg.id);
          player.seekTo(elapsed, true);
          if (!msg.isPaused) {
            player.playVideo();
          } else {
            player.pauseVideo();
          }
        }
        if (msg.type === "pause" && player) {
          player.pauseVideo();
        }
      };

      ws.onclose = () => {
        console.log("üîå WebSocket Ï¢ÖÎ£åÎê®, Ïû¨Ïó∞Í≤∞...");
        setTimeout(connectWebSocket, 1000);
      };
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player("player", {
        height: "1",
        width: "1",
        videoId: "",
        playerVars: {
          autoplay: 1,
          mute: 0,
          playsinline: 1
        }
      });
      connectWebSocket();
    }

    const tag = document.createElement("script");
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);
    window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
  </script>
</body>
</html>
